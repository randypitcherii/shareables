{
  "generators": [
    {
      "name": "cdc_events",
      "topic": { "_gen": "env", "var": "KAFKA_TOPIC" },
      "vars": {
        "shadow_traffic_stage": null,
        "event_type": {
          "_gen": "weightedOneOf",
          "choices": [
            {
              "weight": 1.2,
              "value": {
                "record_type": "INSERT",
                "record_id": { "_gen": "uuid" }
              }
            },
            {
              "weight": 98.8,
              "value": {
                "record_type": "UPDATE",
                "record_id": { 
                  "_gen": "lookup", 
                  "name": "cdc_events", 
                  "path": ["value", "record_id"], 
                  "strategy": "random" 
                }
              }
            }
          ]
        }
      },

      "key": { 
        "_gen": "var", 
        "var": "event_type", 
        "path": ["record_id"] 
      },
      
      "value": {
        "record_id": { "_gen": "var", "var": "event_type", "path": ["record_id"] },
        "record_type": { "_gen": "var", "var": "event_type", "path": ["record_type"] },
        "record_sequence": { "_gen": "now", "format": "unix_ms" },
        "source": "ShadowTraffic",
        "run_started_at": { "_gen": "env", "var": "RUN_STARTED_AT" },
        "record_payload": {
          "payload_string": { "_gen": "env", "var": "PAYLOAD_STRING" },
          "updated_at": { "_gen": "now", "format": "iso" },
          "value": { "_gen": "oneOf", "choices": [
            "ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸˆ","ğŸ’","ğŸª","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥",
            "ğŸŒ¶ï¸","ğŸ¥•","ğŸ¥¦","ğŸ§„","ğŸ§…","ğŸ¥”","ğŸ ","ğŸ¥","ğŸ¥¯","ğŸ","ğŸ¥–","ğŸ§€","ğŸ¥š","ğŸ¥","ğŸ§‡",
            "ğŸ”","ğŸŸ","ğŸ•","ğŸŒ­","ğŸ¥ª","ğŸŒ®","ğŸŒ¯","ğŸ¥—","ğŸ¿","ğŸ§ˆ","ğŸ±","ğŸ£","ğŸ¤","ğŸ™","ğŸš",
            "ğŸœ","ğŸ²","ğŸ›","ğŸ","ğŸ¥®","ğŸ¢","ğŸ¡","ğŸ§","ğŸ¨","ğŸ¦","ğŸ¥§","ğŸ°","ğŸ§","ğŸ®","ğŸ­",
            "ğŸ¬","ğŸ«","ğŸ©","ğŸª","ğŸ¥œ","ğŸŒ°","ğŸ¥›","ğŸ¼","â˜•","ğŸµ","ğŸ§ƒ","ğŸ¥¤","ğŸ¶","ğŸº","ğŸ»",
            "ğŸ¥‚","ğŸ·","ğŸ¥ƒ","ğŸ¸","ğŸ¹","ğŸ¾","ğŸ§Š","ğŸ§‚","ğŸ¥„","ğŸ´","ğŸ½ï¸","ğŸ¥£","ğŸ¥¡","ğŸ¥¢",
            "âš½","ğŸ€","ğŸˆ","âš¾","ğŸ¾","ğŸ","ğŸ‰","ğŸ±","ğŸ“","ğŸ¸","ğŸ¥…","ğŸ’","ğŸ‘","ğŸ","ğŸ¥",
            "ğŸ¹","ğŸ£","ğŸ¤¿","ğŸ¥Š","ğŸ¥‹","ğŸ½","ğŸ›¹","ğŸ›·","â›¸ï¸","ğŸ¥Œ","ğŸ¿","â›·ï¸","ğŸ‚","ğŸª‚",
            "ğŸ†","ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰","ğŸ–ï¸","ğŸ…","ğŸ—ï¸","ğŸ«","ğŸŸï¸","ğŸª","ğŸ¤¹","ğŸ­","ğŸ©°","ğŸ¨",
            "ğŸ¬","ğŸ¤","ğŸ§","ğŸ¼","ğŸ¹","ğŸ¥","ğŸ·","ğŸº","ğŸ¸","ğŸª•","ğŸ»","ğŸ²","â™Ÿï¸","ğŸ®","ğŸ•¹ï¸",
            "ğŸ°","ğŸ¯","ğŸ§©","ğŸ§¸","ğŸª","ğŸª€","ğŸ§µ","ğŸ§¶","ğŸª¡","ğŸª¢","ğŸ§¿","ğŸª¬","ğŸª„","ğŸª…","ğŸª†"
          ] }
        }
      }
    }
  ],


  "schedule": {
    "stages": [
      {
        "generators": ["cdc_events"],
        "overrides": {
          "cdc_events": {
            "vars": {
              "shadow_traffic_stage": "initial_inserts",
              "event_type": {
                "_gen": "weightedOneOf",
                "choices": [
                  {
                    "weight": 100,
                    "value": {
                      "record_type": "INSERT",
                      "record_id": { "_gen": "uuid" }
                    }
                  },
                  {
                    "weight": 0,
                    "value": {
                      "record_type": "UPDATE",
                      "record_id": { 
                        "_gen": "lookup", 
                        "name": "cdc_events", 
                        "path": ["value", "record_id"], 
                        "strategy": "random" 
                      }
                    }
                  }
                ]
              }
            },
            "localConfigs": {
              "events": { "exactly": 190000 }
            }
          }
        }
      },

      {
        "generators": ["cdc_events"],
        "overrides": {
          "cdc_events": {
            "vars": {
              "shadow_traffic_stage": "cdc_ongoing_simulation",
            "localConfigs": {
              "throughput": 231
            }
          }
        }
      }
    ]
  },


  "connections": {
    "kafka": {
      "kind": "kafka",

      "topicPolicy": {
        "policy": "dropAndCreate",
        "partitions": 5,
        "replicationFactor": 1
      },

      "producerConfigs": {
        "bootstrap.servers": { "_gen": "env", "var": "KAFKA_BROKERS" },
        "security.protocol": "SASL_SSL",
        "sasl.mechanism": "SCRAM-SHA-512",
        "sasl.jaas.config": { "_gen": "env", "var": "KAFKA_SASL_JAAS_CONFIG" },
        "key.serializer": "io.shadowtraffic.kafka.serdes.JsonSerializer",
        "value.serializer": "io.shadowtraffic.kafka.serdes.JsonSerializer",
        "batch.size": "2097152",
        "linger.ms": "200",
        "compression.type": "lz4",
        "acks": "0",
        "buffer.memory": "67108864",
        "retries": "0",
        "max.in.flight.requests.per.connection": "5"
      }
    }
  }
}
