{
  "generators": [
    {
      "name": "cdc_events",
      "topic": { "_gen": "env", "var": "KAFKA_TOPIC" },
      "vars": {
        "event_type": {
          "_gen": "oneOf",
          "choices": [
            {
              "record_type": "INSERT",
              "record_id": { "_gen": "uuid" }
            },
            {
              "record_type": "UPDATE",
              "record_id": { 
                "_gen": "lookup", 
                "name": "cdc_events", 
                "path": ["value", "record_id"], 
                "strategy": "random" 
              }
            }
          ],
          "weights": [1.2, 98.8]
        }
      },
      "value": {
        "record_id": { "_gen": "var", "var": "event_type", "path": ["record_id"] },
        "record_type": { "_gen": "var", "var": "event_type", "path": ["record_type"] },
        "record_sequence": { "_gen": "now", "format": "unix_ms" },
        "source": "ShadowTraffic",
        "run_started_at": { "_gen": "env", "var": "RUN_STARTED_AT" },
        "record_payload": {
          "payload_string": { "_gen": "env", "var": "PAYLOAD_STRING" },
          "updated_at": { "_gen": "now", "format": "iso" },
          "value": { "_gen": "oneOf", "choices": [
            "🍎","🍊","🍋","🍌","🍉","🍇","🍓","🫐","🍈","🍒","🪐","🥭","🍍","🥥","🥝",
            "🌶️","🥕","🥦","🧄","🧅","🥔","🍠","🥐","🥯","🍞","🥖","🧀","🥚","🥞","🧇",
            "🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥗","🍿","🧈","🍱","🍣","🍤","🍙","🍚",
            "🍜","🍲","🍛","🍝","🥮","🍢","🍡","🍧","🍨","🍦","🥧","🍰","🧁","🍮","🍭",
            "🍬","🍫","🍩","🍪","🥜","🌰","🥛","🍼","☕","🍵","🧃","🥤","🍶","🍺","🍻",
            "🥂","🍷","🥃","🍸","🍹","🍾","🧊","🧂","🥄","🍴","🍽️","🥣","🥡","🥢",
            "⚽","🏀","🏈","⚾","🎾","🏐","🏉","🎱","🏓","🏸","🥅","🏒","🏑","🏏","🥍",
            "🏹","🎣","🤿","🥊","🥋","🎽","🛹","🛷","⛸️","🥌","🎿","⛷️","🏂","🪂",
            "🏆","🥇","🥈","🥉","🎖️","🏅","🎗️","🎫","🎟️","🎪","🤹","🎭","🩰","🎨",
            "🎬","🎤","🎧","🎼","🎹","🥁","🎷","🎺","🎸","🪕","🎻","🎲","♟️","🎮","🕹️",
            "🎰","🎯","🧩","🧸","🪁","🪀","🧵","🧶","🪡","🪢","🧿","🪬","🪄","🪅","🪆"
          ] }
        }
      },
      "localConfigs": { "throughput": 231 }
    }
  ],


  "schedule": {
    "stages": [
      {
        // Initial high-throughput load of insert records
        "generators": ["cdc_events"],
        "overrides": {
          "cdc_events": {
            "value": {
              "event_type": {
                "weights": [100, 0] // override to 100% inserts
              }
            },
            "localConfigs": {
              "throughput": 5000,
              "events": { "exactly": 190000 }
            }
          }
        }
      },

      {
        // Ongoing cdc events, using the default weighting and throughput
        "generators": ["cdc_events"] 
      }
    ]
  },


  "connections": {
    "kafka": {
      "kind": "kafka",
      "producerConfigs": {
        "bootstrap.servers": { "_gen": "env", "var": "KAFKA_BROKERS" },
        "security.protocol": "SASL_SSL",
        "sasl.mechanism": "SCRAM-SHA-512",
        "sasl.jaas.config": { "_gen": "env", "var": "KAFKA_SASL_JAAS_CONFIG" },
        "key.serializer": "io.shadowtraffic.kafka.serdes.JsonSerializer",
        "value.serializer": "io.shadowtraffic.kafka.serdes.JsonSerializer",
        "batch.size": "2097152",
        "linger.ms": "200",
        "compression.type": "lz4",
        "acks": "0",
        "buffer.memory": "67108864",
        "retries": "0",
        "max.in.flight.requests.per.connection": "5"
      }
    }
  }
}
