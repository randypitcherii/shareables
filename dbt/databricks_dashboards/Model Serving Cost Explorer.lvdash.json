{"datasets":[{"name":"247b909c","displayName":"Foundation Model Serving Usage","query":"with latest_list_prices as (\n  SELECT \n      *,\n      pricing.default::float as list_price_usd\n      \n  FROM \n    system.billing.list_prices\n\n  where \n    price_end_time is null\n),\n\nmodel_serving_usage as (\n  SELECT\n    *\n  FROM\n    system.billing.usage\n  WHERE\n    billing_origin_product = 'MODEL_SERVING'\n),\n\nranked_model_serving_endpoints AS (\n    SELECT \n        *,\n        ROW_NUMBER() OVER (\n            PARTITION BY endpoint_id \n            ORDER BY endpoint_config_version DESC\n        ) AS rn\n    FROM \n        system.serving.served_entities\n),\n\nlatest_model_serving_endpoints as (\n  SELECT \n      endpoint_id,\n      endpoint_name,\n      created_by as endpoint_created_by,\n      workspace_id,\n      change_time as last_updated_at,\n      endpoint_delete_time is not null as is_deleted\n\n  FROM \n      ranked_model_serving_endpoints\n\n  where 1 = rn\n)\n\nselect\n  usage.*,\n  usage.product_features.serving_type as model_serving_type,\n\n  usage.usage_quantity * pricing.list_price_usd as usage_list_price_usd,\n\n  endpoints.endpoint_name,\n  endpoints.endpoint_created_by,\n  endpoints.is_deleted as endpoint_is_deleted\n\nfrom\n  model_serving_usage usage \n  left outer join latest_list_prices pricing \n    on usage.sku_name = pricing.sku_name\n  left outer join latest_model_serving_endpoints endpoints\n    on usage.usage_metadata.endpoint_id = endpoints.endpoint_id"},{"name":"d7f94563","displayName":"served_entities","query":"WITH latest_endpoints AS (\n    SELECT \n        *,\n        ROW_NUMBER() OVER (\n            PARTITION BY endpoint_id \n            ORDER BY endpoint_config_version DESC\n        ) AS rn\n    FROM \n        system.serving.served_entities\n)\n\nSELECT \n    endpoint_id,\n    endpoint_name,\n    created_by as endpoint_created_by,\n    workspace_id,\n    change_time as last_updated_at,\n    endpoint_delete_time is not null as is_deleted\n\nFROM \n    latest_endpoints\n\nwhere 1 = rn\n"}],"pages":[{"name":"e60b836f","displayName":"Serving Costs","layout":[{"widget":{"name":"4afb70ae","queries":[{"name":"main_query","query":{"datasetName":"247b909c","fields":[{"name":"sum(usage_list_price_usd)","expression":"SUM(`usage_list_price_usd`)"},{"name":"model_serving_type","expression":"`model_serving_type`"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(usage_list_price_usd)","scale":{"type":"quantitative"},"format":{"type":"number-currency","currencyCode":"USD","abbreviation":"compact","decimalPlaces":{"type":"max","places":2}},"axis":{"hideTitle":true},"displayName":"Sum of usage_list_price_usd"},"y":{"fieldName":"model_serving_type","scale":{"type":"categorical","sort":{"by":"x-reversed"}},"axis":{"hideTitle":true},"displayName":"model_serving_type"},"label":{"show":true}},"frame":{"title":"Spend in USD by Model Serving Type","showTitle":true}}},"position":{"x":3,"y":5,"width":3,"height":6}},{"widget":{"name":"cb1912c8","queries":[{"name":"main_query","query":{"datasetName":"247b909c","fields":[{"name":"sku_name","expression":"`sku_name`"},{"name":"model_serving_type","expression":"`model_serving_type`"},{"name":"sum(usage_list_price_usd)","expression":"SUM(`usage_list_price_usd`)"}],"cubeGroupingSets":{"sets":[{"fieldNames":["sku_name"]},{"fieldNames":["model_serving_type"]}]},"disaggregated":false,"orders":[{"direction":"ASC","expression":"`sku_name`"},{"direction":"ASC","expression":"`model_serving_type`"}]}}],"spec":{"version":3,"widgetType":"pivot","encodings":{"rows":[{"fieldName":"sku_name","displayTotal":true,"scale":{"type":"categorical","sort":{"by":"cell-reversed","field":{"index":0}}},"displayName":"sku_name"}],"columns":[{"fieldName":"model_serving_type","displayName":"model_serving_type"}],"cell":{"type":"multi-cell","fields":[{"fieldName":"sum(usage_list_price_usd)","cellType":"text","format":{"type":"number-currency","currencyCode":"USD","abbreviation":"none","decimalPlaces":{"type":"exact","places":2},"hideGroupSeparator":false},"style":{"type":"color-scale","backgroundColor":{"scale":{"type":"quantitative","colorRamp":{"mode":"custom-sequential","colors":{"start":"#ffffff","end":"#D62728"}}}}},"displayName":" "}]}}}},"position":{"x":0,"y":11,"width":4,"height":6}},{"widget":{"name":"5081555d","queries":[{"name":"main_query","query":{"datasetName":"247b909c","fields":[{"name":"model_serving_type","expression":"`model_serving_type`"},{"name":"weekly(usage_date)","expression":"DATE_TRUNC(\"WEEK\", `usage_date`)"},{"name":"sum(usage_list_price_usd)","expression":"SUM(`usage_list_price_usd`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"weekly(usage_date)","scale":{"type":"temporal"},"axis":{"hideTitle":true},"displayName":"usage_date"},"y":{"fieldName":"sum(usage_list_price_usd)","scale":{"type":"quantitative"},"format":{"type":"number-currency","currencyCode":"USD","abbreviation":"compact","decimalPlaces":{"type":"max","places":2}},"axis":{"hideTitle":true},"displayName":"Sum of usage_list_price_usd"},"color":{"fieldName":"model_serving_type","scale":{"type":"categorical"},"displayName":"model_serving_type"}},"frame":{"showTitle":true,"title":"Weekly Serving Spend by Serving Type"}}},"position":{"x":0,"y":5,"width":3,"height":6}},{"widget":{"name":"6873645e","queries":[{"name":"main_query","query":{"datasetName":"247b909c","fields":[{"name":"endpoint_created_by","expression":"`endpoint_created_by`"},{"name":"sum(usage_list_price_usd)","expression":"SUM(`usage_list_price_usd`)"}],"cubeGroupingSets":{"sets":[{"fieldNames":["endpoint_created_by"]},{}]},"disaggregated":false,"orders":[{"direction":"ASC","expression":"`endpoint_created_by`"}]}}],"spec":{"version":3,"widgetType":"pivot","encodings":{"rows":[{"fieldName":"endpoint_created_by","displayTotal":true,"scale":{"type":"categorical","sort":{"by":"cell-reversed","field":{"index":0}}},"displayName":"Creator"}],"cell":{"type":"multi-cell","fields":[{"fieldName":"sum(usage_list_price_usd)","cellType":"text","format":{"type":"number-currency","currencyCode":"USD","abbreviation":"none","decimalPlaces":{"type":"exact","places":2},"hideGroupSeparator":false},"style":{"type":"color-scale","backgroundColor":{"scale":{"type":"quantitative","colorRamp":{"mode":"custom-sequential","colors":{"start":"#ffffff","end":"#D62728"}}}}},"displayName":"Total Spend"}]}}}},"position":{"x":4,"y":11,"width":2,"height":6}},{"widget":{"name":"c8a60b74","queries":[{"name":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_usage_date","query":{"datasetName":"247b909c","fields":[{"name":"usage_date","expression":"`usage_date`"},{"name":"usage_date_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-date-range-picker","encodings":{"fields":[{"fieldName":"usage_date","displayName":"usage_date","queryName":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_usage_date"}]},"selection":{"defaultSelection":{"range":{"dataType":"DATE","min":{"value":"now-365d/d"},"max":{"value":"now/d"}}}},"frame":{"showTitle":false,"title":""}}},"position":{"x":0,"y":4,"width":3,"height":1}},{"widget":{"name":"aaf9a6ae","queries":[{"name":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_endpoint_name","query":{"datasetName":"247b909c","fields":[{"name":"endpoint_name","expression":"`endpoint_name`"},{"name":"endpoint_name_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"endpoint_name","displayName":"endpoint_name","queryName":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_endpoint_name"}]},"frame":{"showTitle":true,"title":"Endpoint"}}},"position":{"x":3,"y":4,"width":1,"height":1}},{"widget":{"name":"5e13683d","queries":[{"name":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_endpoint_created_by","query":{"datasetName":"247b909c","fields":[{"name":"endpoint_created_by","expression":"`endpoint_created_by`"},{"name":"endpoint_created_by_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"endpoint_created_by","displayName":"endpoint_created_by","queryName":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_endpoint_created_by"}]},"frame":{"showTitle":true,"title":"Created by"}}},"position":{"x":4,"y":4,"width":1,"height":1}},{"widget":{"name":"d66dbc24","queries":[{"name":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_workspace_id","query":{"datasetName":"247b909c","fields":[{"name":"workspace_id","expression":"`workspace_id`"},{"name":"workspace_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"workspace_id","displayName":"workspace_id","queryName":"dashboards/01f0043fd51c12a68d1248406659a35f/datasets/01f0043fd9fd178b9ba5061b67d38533_workspace_id"}]},"frame":{"showTitle":true,"title":"Workspace"}}},"position":{"x":5,"y":4,"width":1,"height":1}},{"widget":{"name":"21e35907","textbox_spec":"# Model Serving Cost Explorer\nðŸ‘‹ Hey! I bet you're wondering how much all that model serving is costing you. Well let's find out.\n\nBut first, some caveats:\n- this dashboard uses the **latest sticker prices** to get USD ðŸ’¸ -- you'll need to do some proper dbt-powered pipeline building to get your actual costs ðŸ’ª\n- it also doesn't bother to check your cloud provider costs. This matters because serverless usage will show about the full costs but non-serverless costs will exclude your VM/GPU/Hardware costs, which are pretty giant typically.\n\nOk have fun!!!"},"position":{"x":0,"y":0,"width":6,"height":4}}]}]}